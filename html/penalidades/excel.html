<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Exportar Excel ‚Äî Asistencia & Penalidades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- CSS del m√≥dulo (tema claro) -->
  <link rel="stylesheet" href="../../css/penalidades/excel.css" />
  <!-- Supabase y SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
  <main class="wrap">
    <!-- HOME: Tarjetas centradas -->
    <section id="home" class="home">
      <div class="cards">
        <div id="cardAsis" class="home-card" role="button" tabindex="0" aria-label="Reporte Asistencia">
          <div class="card-icon">üìä</div>
          <div class="card-title">Reporte Asistencia</div>
          <div class="card-sub">Preview y Excel de tardanzas con penalidad</div>
        </div>

        <div id="cardPen" class="home-card" role="button" tabindex="0" aria-label="Reporte Penalidades">
          <div class="card-icon">üìë</div>
          <div class="card-title">Reporte Penalidades</div>
          <div class="card-sub">Preview y Excel de penalidades aplicadas</div>
        </div>
      </div>
    </section>

    <!-- VIEW: Vista expandida -->
    <section id="view" class="view hidden">
      <div class="view-header">
        <div class="vh-titles">
          <h2 id="vhTitle">Reporte</h2>
          <div id="vhSub" class="vh-sub">‚Äî</div>
        </div>
        <div class="vh-actions">
          <button id="btnBack" class="btn back">‚üµ Regresar</button>

          <!-- Botones ASISTENCIA -->
          <button id="btnAsisLoad" class="btn view-only-asis">Cargar Asistencia</button>
          <button id="btnAsisDownload" class="btn view-only-asis">Descargar Asistencia (Excel)</button>

          <!-- Botones PENALIDADES -->
          <button id="btnPenLoad" class="btn view-only-pen hidden">Cargar Penalidades</button>
          <button id="btnPenDownload" class="btn view-only-pen hidden">Descargar Penalidades (Excel)</button>
        </div>
      </div>

      <section class="card" style="padding: 16px;">
        <div class="filters">
          <div class="row">
            <label>Empresa</label>
            <select id="fEmpresa">
              <!-- Se cargan SOLO 2 (labels UI): CORSEPRI S.A. / VICMER SECURITY -->
            </select>
          </div>
          <div class="row">
            <label>Local</label>
            <select id="fLocal">
              <option value="">Todos los locales</option>
              <option>TPP1</option>
              <option>TPP2</option>
              <option>TPP3</option>
              <option>TPP4</option>
              <option>ANEXO</option>
            </select>
          </div>
          <div class="row">
            <label>Desde</label>
            <input type="date" id="fDesde" />
          </div>
          <div class="row">
            <label>Hasta</label>
            <input type="date" id="fHasta" />
          </div>

          <!-- Dropdown multiselecci√≥n (solo Asistencia) -->
          <div class="row grow" id="estadoBox">
            <label>Estado (multiselecci√≥n)</label>
            <div class="multi">
              <button id="multiBtn" class="multi-btn" aria-haspopup="true" aria-expanded="false">
                Seleccionar estados
                <span class="multi-badge" id="multiBadge">Todos</span>
              </button>
              <div id="multiMenu" class="multi-menu" role="menu" hidden>
                <label class="opt"><input type="checkbox" data-state="all" checked /> Todos</label>
                <label class="opt"><input type="checkbox" data-state="puntual" checked /> Puntualidad</label>
                <label class="opt"><input type="checkbox" data-state="tardanza" checked /> Tardanza</label>
                <label class="opt"><input type="checkbox" data-state="falto" checked /> Faltos</label>
              </div>
            </div>
          </div>
        </div>

        <div class="statebar">
          <div class="kpis">
            <div class="kpi"><div class="kpi-label">Rango</div><div class="kpi-value" id="kpiRange">‚Äî</div></div>
            <div class="kpi"><div class="kpi-label">Vista</div><div class="kpi-value" id="kpiVista">‚Äî</div></div>
            <div class="kpi"><div class="kpi-label">Filas</div><div class="kpi-value" id="kpiCount">0</div></div>
          </div>
          <div class="totalbar">
            <div class="total-label">Total Penalidades</div>
            <div class="total-value" id="totalMonto">S/ 0.00</div>
          </div>
        </div>

        <div id="loading" class="loading" hidden></div>

        <div class="table-wrap">
          <table id="tblPreview">
            <thead>
              <tr id="theadRow">
                <!-- Cabeceras din√°micas -->
              </tr>
            </thead>
            <tbody><!-- din√°mico --></tbody>
          </table>
          <div id="hint" class="hint">Elige el rango de fechas y presiona ‚ÄúCargar ‚Ä¶‚Äù para ver el preview.</div>
        </div>

        <div class="paginator">
          <div class="left">
            <label class="sr">Tama√±o de p√°gina</label>
            <select id="pageSize">
              <option>10</option>
              <option selected>20</option>
              <option>50</option>
            </select>
          </div>
          <div class="right">
            <button id="btnPrev" class="pagebtn">Anterior</button>
            <span id="pageInfo" class="sr">P√°gina 1</span>
            <button id="btnNext" class="pagebtn">Siguiente</button>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- Config y Supabase client -->
  <script src="../../config.js"></script>
  <script src="../../js/core/supabaseClient.js"></script>
  <!-- L√≥gica del m√≥dulo -->
  <script src="../../js/penalidades/excel.js"></script>
</body>
</html>
