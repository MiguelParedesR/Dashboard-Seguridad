<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Exportar Excel ‚Äî Asistencia & Penalidades</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CSS del m√≥dulo (tema claro) -->
    <link rel="stylesheet" href="../../css/penalidades/excel.css" />
    <!-- Supabase y SheetJS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
    <main class="wrap">

        <!-- HOME: Tarjetas centradas -->
        <section id="home" class="home">
            <div class="cards">
                <button class="card home-card" id="cardAsis">
                    <div class="card-icon">üïí</div>
                    <div class="card-title">Reporte Asistencia</div>
                    <div class="card-sub">Tardanzas con penalidad (S/.)</div>
                </button>

                <button class="card home-card" id="cardPen">
                    <div class="card-icon">üßæ</div>
                    <div class="card-title">Reporte Penalidades</div>
                    <div class="card-sub">Penalidades aplicadas (S/.)</div>
                </button>
            </div>
        </section>

        <!-- VIEW: Contenedor expandible -->
        <section id="view" class="view hidden">

            <!-- Header vista activa -->
            <div class="view-header">
                <button id="btnBack" class="btn back">‚Üê Regresar</button>
                <div class="vh-titles">
                    <h2 id="vhTitle">‚Äî</h2>
                    <div id="vhSub" class="vh-sub">‚Äî</div>
                </div>
                <div class="vh-actions">
                    <button id="btnAsisLoad" class="btn ghost hidden">Cargar Asistencia</button>
                    <button id="btnAsisDownload" class="btn hidden">Descargar Asistencia (Excel)</button>

                    <button id="btnPenLoad" class="btn ghost hidden">Cargar Penalidades</button>
                    <button id="btnPenDownload" class="btn hidden">Descargar Penalidades (Excel)</button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters">
                <div class="row">
                    <label>Empresa</label>
                    <select id="fEmpresa">
                        <option value="">Todas las empresas</option>
                    </select>
                </div>

                <div class="row">
                    <label>Local</label>
                    <select id="fLocal">
                        <option value="">Todos los locales</option>
                        <option>TPP1</option>
                        <option>TPP2</option>
                        <option>TPP3</option>
                        <option>TPP4</option>
                        <option>ANEXO</option>
                    </select>
                </div>

                <div class="row">
                    <label>Desde</label>
                    <input type="date" id="fDesde" />
                </div>

                <div class="row">
                    <label>Hasta</label>
                    <input type="date" id="fHasta" />
                </div>

                <!-- Dropdown multiselecci√≥n (solo Asistencia) -->
                <div class="row grow" id="estadoBox">
                    <label>Estado</label>
                    <div class="multi">
                        <button id="multiBtn" class="multi-btn" aria-haspopup="true" aria-expanded="false">
                            Seleccionar estados
                            <span class="multi-badge" id="multiBadge">Todos</span>
                        </button>
                        <div id="multiMenu" class="multi-menu" role="menu" hidden>
                            <label class="opt"><input type="checkbox" data-state="all" checked /> Todos</label>
                            <label class="opt"><input type="checkbox" data-state="puntual" checked />
                                Puntualidad</label>
                            <label class="opt"><input type="checkbox" data-state="tardanza" checked /> Tardanza</label>
                            <label class="opt"><input type="checkbox" data-state="falto" checked /> Faltos</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KPIs + Total -->
            <div class="statebar">
                <div class="kpis">
                    <div class="kpi">
                        <div class="kpi-label">Rango</div>
                        <div class="kpi-value" id="kpiRange">‚Äî</div>
                    </div>
                    <div class="kpi">
                        <div class="kpi-label">Filas</div>
                        <div class="kpi-value" id="kpiCount">0</div>
                    </div>
                </div>
                <div class="totalbar">
                    <div class="total-label">Total Penalidades</div>
                    <div class="total-value" id="totalMonto">S/ 0.00</div>
                </div>
            </div>

            <div id="loading" class="loading" hidden></div>

            <!-- Tabla preview -->
            <div class="table-wrap">
                <table id="tblPreview">
                    <thead>
                        <tr id="theadRow"><!-- din√°mico --></tr>
                    </thead>
                    <tbody><!-- din√°mico --></tbody>
                </table>
                <div id="hint" class="hint">Elige el rango de fechas y presiona ‚ÄúCargar ‚Ä¶‚Äù para ver el preview.</div>
            </div>

            <!-- Paginaci√≥n simple (cliente) -->
            <div class="paginator">
                <div class="left">
                    <label class="sr">Tama√±o de p√°gina</label>
                    <select id="pageSize">
                        <option>10</option>
                        <option selected>20</option>
                        <option>50</option>
                    </select>
                </div>
                <div class="right">
                    <button id="btnPrev" class="pagebtn">Anterior</button>
                    <span id="pageInfo" class="sr">P√°gina 1</span>
                    <button id="btnNext" class="pagebtn">Siguiente</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Config y Supabase client -->
    <script src="../../config.js"></script>
    <script src="../../js/core/supabaseClient.js"></script>
    <!-- L√≥gica del m√≥dulo -->
    <script src="../../js/penalidades/excel.js"></script>
</body>

</html>